<div class="layout-sidemenu">
    <nav class="sidebar expanded">

        <!-- Menu Content -->
        <div class="menu-content">
            <ng-container *ngFor="let section of menuSections">
                <!-- Section Title -->
                <div class="section-title">
                    {{ section.title }}
                </div>

                <!-- Menu Items -->
                <ul class="menu-list">
                    <ng-container *ngFor="let item of section.items">
                        <!-- Parent Item with Children -->
                        <li *ngIf="item.children" class="menu-item parent-item">
                            <div class="menu-item-header" 
                                 (click)="toggleMenu(item.id, $event)"
                                 [class.active]="isMenuExpanded(item.id)">
                                <i [class]="item.icon"></i>
                                <span class="menu-label">{{ item.label }}</span>
                                <i class="fa fa-chevron-down expand-arrow" 
                                   [class.rotated]="!isMenuExpanded(item.id)"></i>
                            </div>
                            
                            <!-- Submenu -->
                            <ul class="submenu" *ngIf="isMenuExpanded(item.id)">
                                <li *ngFor="let child of item.children" 
                                    class="submenu-item"
                                    [class.active]="isActive(child.id)"
                                    (click)="navigate(child.route, child.id)">
                                    <span class="submenu-label">{{ child.label }}</span>
                                </li>
                            </ul>
                        </li>

                        <!-- Simple Item without Children -->
                        <li *ngIf="!item.children" 
                            class="menu-item simple-item"
                            [class.active]="isActive(item.id)"
                            (click)="navigate(item.route, item.id)">
                            <i [class]="item.icon"></i>
                            <span class="menu-label">{{ item.label }}</span>
                        </li>
                    </ng-container>
                </ul>
            </ng-container>
        </div>

        <!-- Portal Selector at Bottom -->
        <div class="portal-selector-container" (click)="togglePortalMenu($event)">
            <div class="portal-selector">
                <img [src]="selectedPortal.icon" alt="" class="portal-icon" />
                <div class="portal-info">
                    <span class="portal-title">{{ selectedPortal?.name }}</span>
                    <span class="portal-subtitle">ACTIVE WORKSPACE</span>
                </div>
                <i class="fa fa-chevron-up portal-arrow" [class.rotated]="isPortalMenuOpen"></i>
            </div>
            
            <div class="portal-menu" *ngIf="isPortalMenuOpen">
                <div class="portal-menu-item" 
                     *ngFor="let portal of portalOptions" 
                     (click)="selectPortal(portal, $event)"
                     [class.active]="portal.code === selectedPortal.code">
                    <img [src]="portal?.icon" alt="" class="portal-icon" />
                    <div class="portal-info">
                        <span class="portal-title">{{ portal?.name }}</span>
                        <span class="portal-subtitle">{{ portal?.description }}</span>
                    </div>
                </div>
            </div>
        </div>
    </nav>
</div>
