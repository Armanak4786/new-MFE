<div class="grid">
  <div class="sm:col-7 md:col-7 lg:col-7">
    <div class="card p-2">
      <div class="grid">
        <div class="col-2">
          <text
            [mode]="'label'"
            [labelClass]="'loan-dash-text font-bold mt-2 ml-2'"
            [label]="'loan_details'"
          ></text>
        </div>
        <div class="col-offset-8 col-2 flex justify-content-end">
          <a
            class="loan-dash-text font-bold text-blue-600 cursor-pointer"
            (click)="op.toggle($event)"
          >
            {{ "loan_parties" | translate }}
          </a>
        </div>
      </div>
      <p-overlayPanel #op>
        <div class="flex flex-column gap-3 w-25rem">
          <app-loan-parties
            [leasePartiesData]="loanPartiesData"
            [leasePartiesColumnDef]="loanPartiesColumnDef"
          ></app-loan-parties>
        </div>
      </p-overlayPanel>
      <div class="flex flex-wrap justify-between gap-2 mb-2">
        <div class="flex-1 min-w-[150px]">
          <text
            [mode]="'label'"
            [className]="'trim_label'"
            [labelClass]="'loan-dash-text loan-dash-text-color  mt-3 ml-2'"
            [label]="'product'"
          ></text>
          <text
            [mode]="'label'"
            [valueClass]="'text-xs ml-2 mt-1'"
            [className]="'trim_label'"
            [labelClass]="'mt-1'"
            [value]="loanData?.productType"
            [title]="loanData?.productType"
          ></text>
        </div>
        <div class="flex-1 min-w-[150px]">
          <amount
            [mode]="'label'"
            [labelClass]="'loan-dash-text loan-dash-text-color text-right mt-3 mb-1'"
            [label]="'amount_financed'"
            [labelType]="'vertical'"
            [valueClass]="'text-xs'"
            [value]="loanData?.initialLoanAmount"
          >
          </amount>
        </div>
        <div class="flex-1 min-w-[150px]">
          <date
            *ngIf="facilityType === 'AssetLink' || facilityType === 'EasyLink'"
            [labelClass]="'loan-dash-text loan-dash-text-color flex mt-2 ml-2'"
            [label]="'start_date'"
            [valueClass]="'text-xs ml-2 mt-1 block w-full'"
            [value]="loanData?.startDate"
            [mode]="'label'"
          ></date>
          <date
            *ngIf="facilityType === 'Non-Facility Loan'"
            [mode]="'label'"
            [labelClass]="'loan-dash-text loan-dash-text-color flex mt-2 ml-2'"
            [label]="'loan_date'"
            [valueClass]="'text-xs ml-2 mt-1 block w-full'"
            [value]="loanData?.startDate"
          ></date>
        </div>
        <div class="flex-1 min-w-[150px]">
          <text
            *ngIf="
              facilityType === 'AssetLink' ||
              facilityType === 'EasyLink' ||
              facilityType === 'Non-Facility Loan'
            "
            [mode]="'label'"
            [labelClass]="'loan-dash-text loan-dash-text-color flex mt-2 ml-2'"
            [label]="'loan_term'"
            [labelType]="'floating'"
            [valueClass]="'text-xs ml-2 mt-1 block w-full'"
            [value]="loanData?.loanTerm"
          ></text>
        </div>
        <div class="flex-1 min-w-[150px]">
          <date
            [mode]="'label'"
            [labelClass]="
              'loan-dash-text loan-dash-text-color flex flex mt-2 ml-2'
            "
            [label]="'maturity_date'"
            [valueClass]="'text-xs ml-2 mt-1 block w-full'"
            [value]="loanData?.maturityDate"
          ></date>
        </div>
        <div class="flex-1 min-w-[150px]">
          <text
            [mode]="'label'"
            [labelClass]="'loan-dash-text loan-dash-text-color flex mt-2 ml-2'"
            [label]="'interest_charge'"
            [valueClass]="'text-xs ml-2 mt-1 block w-full'"
            [value]="loanData?.interestCharge"
          ></text>
        </div>
      </div>

      <div class="flex flex-wrap justify-between gap-7 mb-3">
        <div
          class="min-w-[150px] mr-5"
          *ngIf="
            loanData?.interestRate !== null &&
            loanData?.interestRate !== undefined
          "
        >
          <div>
            <text
              [mode]="'label'"
              [labelClass]="
                'loan-dash-text loan-dash-text-color flex mt-2 ml-2'
              "
              [label]="'interest_rate'"
            ></text>
            <a
              (click)="interestRate.toggle($event)"
              class="loan-dash-text text-blue-600 cursor-pointer ml-2"
            >
              {{ loanData?.interestRate | number : "1.2-2" }}%
            </a>
          </div>
        </div>
        <div class="min-w-[150px]">
          <date
            [mode]="'label'"
            [labelClass]="'loan-dash-text loan-dash-text-color flex mt-2'"
            [label]="'next_reprice_rate'"
            [valueClass]="'text-xs block w-full'"
            [value]="loanData?.nextRepriceDate"
          >
          </date>
        </div>
      </div>
    </div>
  </div>

  <p-overlayPanel #interestRate>
    <div class="flex flex-column gap-3 w-18rem">
      <text
        [mode]="'label'"
        [labelClass]="'loan-dash-text loan-dash-text-color'"
        [label]="'interest_rate'"
      ></text>
      <gen-table
        [columns]="interestRateColumnDefs"
        [headingClass]="'tableHeader text-xs  header-text-color'"
        [tableClass]="'border-round'"
        [dataList]="interesRateData"
        [overlayPanelWidth]="'w-15rem'"
        [isScrollable]="'true'"
        [tableStyle]="'stripped-rows'"
        [bodyClass]="'text-xs'"
      ></gen-table>
    </div>
  </p-overlayPanel>
  <ng-container *ngIf="facilityType === 'Non-Facility Loan'">
    <div class="sm:col-5 md:col-5 lg:col-5">
      <div class="card p-2">
        <div class="grid">
          <div class="col-4 flex">
            <text
              [mode]="'label'"
              [labelClass]="'loan-dash-text font-bold mt-2 ml-2'"
              [label]="'current_position'"
            ></text>
            <span>
              <i
                class="pi pi-info-circle text-sm text-primary cursor-pointer m-1"
                pTooltip="Balances include accrued interest and overdue interest (if any)"
                tooltipPosition="right"
              ></i>
            </span>
          </div>
        </div>
        <div class="grid">
          <div class="col-4">
            <text
              [mode]="'label'"
              [labelClass]="'loan-dash-text loan-dash-text-color flex mt-2 mb-1'"
              [label]="
                ('gross_balance' | translate) +
                ' ' +
                (toDate | date : 'MM/dd/yyyy')
              "
            ></text>
            <amount
              [mode]="'label'"
              [valueClass]="'text-xs'"
              [labelType]="'vertical'"
              [value]="currentPosition?.[0]?.grossBalanceAsOfToday"
            >
            </amount>
          </div>
          <div class="col-4">
            <text
              [mode]="'label'"
              [labelClass]="'loan-dash-text loan-dash-text-color'"
              [label]="'outstanding_balance'"
            ></text>
            <amount
              [mode]="'label'"
              [valueClass]="'text-xs'"
              [value]="currentPosition?.[0]?.outStandingBalance"
            >
            </amount>
          </div>
          <div class="col-4">
            <text
              [mode]="'label'"
              [labelClass]="'loan-dash-text loan-dash-text-color'"
              [label]="'remaining_interest'"
            ></text>
            <text
              [mode]="'label'"
              [valueClass]="'text-xs'"
              [value]="currentPosition?.[0]?.remainingInterest"
            ></text>
          </div>
        </div>

        <div class="grid">
          <div class="col-5">
            <text
              [mode]="'label'"
              [labelClass]="'loan-dash-text loan-dash-text-color'"
              [label]="'overdue_amount'"
            ></text>
            <div class="flex">
              <amount
                [mode]="'label'"
                [valueClass]="'text-xs'"
                [value]="currentPosition?.[0]?.overdueAmount"
              ></amount>
              <text
                [mode]="'label'"
                [labelClass]="'text-xs'"
                [label]="' / ' + currentPosition?.[0]?.overduedays + ' days'"
              ></text>
            </div>
          </div>
          <div class="col-4">
            <text
              [mode]="'label'"
              [labelClass]="'loan-dash-text loan-dash-text-color'"
              [label]="'remaining_term'"
            ></text>
            <text
              [mode]="'label'"
              [labelClass]="'text-xs'"
              [label]="currentPosition?.[0]?.remainingTerm"
            ></text>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
  <ng-container
    *ngIf="facilityType === 'AssetLink' || facilityType === 'EasyLink'"
  >
    <div class="sm:col-5 md:col-5 lg:col-5">
      <div class="card p-2">
        <div class="grid mb-1">
          <div class="col-4 flex">
            <text
              [mode]="'label'"
              [labelClass]="'loan-dash-text font-bold mt-2 ml-2'"
              [label]="'current_position'"
            ></text>
            <span>
              <i
                class="pi pi-info-circle text-sm text-primary cursor-pointer m-1"
                pTooltip="Balances include accrued interest and overdue interest (if any)"
                tooltipPosition="right"
              ></i>
            </span>
          </div>
        </div>
        <div class="grid mb-1">
          <div class="col-5">
            <amount
              [mode]="'label'"
              [labelClass]="
                'loan-dash-text loan-dash-text-color text-right'
              "
              [label]="
                ('gross_balance' | translate) +
                ' ' +
                (toDate | date : 'MM/dd/yyyy')
              "
              [labelType]="'vertical'"
              [valueClass]="'text-xs'"
              [value]="currentPosition?.[0]?.grossBalanceAsOfToday"
            ></amount>
          </div>
          <div class="col-3">
            <amount
              [mode]="'label'"
              [labelClass]="
                'loan-dash-text loan-dash-text-color text-right'
              "
              [label]="'outstanding_balance'"
              [labelType]="'vertical'"
              [valueClass]="'text-xs'"
              [value]="currentPosition?.[0]?.outStandingBalance"
            >
            </amount>
          </div>
          <div class="col-3">
            <amount
              [mode]="'label'"
              [labelClass]="
              'loan-dash-text loan-dash-text-color text-right'
              "
              [label]="'remaining_interest'"
              [labelType]="'vertical'"
              [valueClass]="'text-xs'"
              [value]="currentPosition?.[0]?.remainingInterest"
            ></amount>
          </div>
          <div class="col-1"></div>
        </div>
        <div class="grid mb-1">
          <div class="col-2"></div>
          <div class="col-4 mr-1">
            <text
              [mode]="'label'"
              [labelClass]="'loan-dash-text loan-dash-text-color flex'"
              [label]="'remaining_term'"
              [labelType]="'vertical'"
              [valueClass]="'text-xs flex mt-1'"
              [value]="currentPosition?.[0]?.remainingTerm"
            ></text>
          </div>
          <div class="col-5">
            <text
              [mode]="'label'"
              [labelType]="'vertical'"
              [labelClass]="'loan-dash-text loan-dash-text-color align-right text-right'"
              [label]="'overdue_amount'"
            ></text>
            <div class="flex justify-content-end gap-2">
              <amount
                [mode]="'label'"
                [valueClass]="'text-xs'"
                [labelType]="'vertical'"
                [value]="currentPosition?.[0]?.overdueAmount"
              ></amount>
              <text
                [mode]="'label'"
                [labelType]="'vertical'"
                [labelClass]="'text-xs'"
                [label]="' / ' + currentPosition?.[0]?.overduedays + ' days'"
              ></text>
            </div>
          </div>
        </div>
      </div>
    </div>
  </ng-container>
</div>
<div class="grid mt-2">
  <div class="col-12 sm:col-12 md:col-7">
    <div class="flex justify-content-start flex-wrap">
      <div class="p-1">
        <gen-button
          [btnType]="
            currentComponent === 'PaymentSummary' ? 'bg-btn' : 'border-btn'
          "
          [btnLabel]="'payment_summary'"
          class="text-xs"
          (onClick)="showPaymentSummaryTab()"
        ></gen-button>
      </div>
      <div class="p-1">
        <gen-button
          [btnType]="
            currentComponent === 'TransactionFlow' ? 'bg-btn' : 'border-btn'
          "
          [btnLabel]="'statement'"
          class="text-xs"
          (onClick)="showLoanStatementTab()"
        ></gen-button>
      </div>
      <div class="p-1">
        <gen-button
          [btnType]="
            currentComponent === 'AssociatedAssets' ? 'bg-btn' : 'border-btn'
          "
          [btnLabel]="'associated_assets'"
          class="text-xs"
          (onClick)="showAssociatedAssetsTab()"
        ></gen-button>
      </div>
      <div class="p-1">
        <gen-button
          [btnType]="
            currentComponent === 'PiSchedule' ? 'bg-btn' : 'border-btn'
          "
          [btnLabel]="'pi_schedule'"
          class="text-xs"
          (onClick)="showPiScheduleTab()"
        ></gen-button>
      </div>
      <div class="p-1">
        <gen-button
          [btnType]="currentComponent === 'Documents' ? 'bg-btn' : 'border-btn'"
          [btnLabel]="'documents'"
          class="text-xs"
          (onClick)="showDocumentsTab()"
        ></gen-button>
      </div>
    </div>
  </div>
  <div class="col-12 sm:col-12 md:col-5">
    <div class="flex justify-content-end flex-wrap">
      <div>
        <gen-button
          [btnType]="'non-bg-btn'"
          [btnLabel]="
            facilityType === 'Non-Facility Loan'
              ? 'view_non_facility'
              : facilityType === 'EasyLink'
              ? 'view_easylink'
              : 'view_assetlink'
          "
          class="text-xs"
          [iconPos]="'right'"
          [btnIcon]="'pi pi-angle-right'"
          (click)="navigateToFacility()"
        >
        </gen-button>
      </div>
      <div>
        <gen-button
          [btnType]="'non-bg-btn'"
          [btnLabel]="'view_loans'"
          class="text-xs"
          [iconPos]="'right'"
          [btnIcon]="'pi pi-angle-right'"
          (click)="navigateToLoansDashboard()"
        ></gen-button>
      </div>
    </div>
  </div>
</div>

<ng-container *ngIf="currentComponent === 'PaymentSummary'">
  <div class="grid">
    <div class="sm:col-7 md:col-7 lg:col-7">
      <app-payment-summary
        [paymentSummaryDataList]="paymentSummaryDataList"
        [paymentSummaryColumnDefs]="paymentSummaryColumnDefs"
      ></app-payment-summary>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="currentComponent === 'PiSchedule'">
  <div class="grid">
    <div class="sm:col-12 md:col-12 lg:col-12">
      <app-pi-schedule
        [piScheduleColumnDefs]="piScheduleColumnDefs"
        [piScheduleDataList]="piScheduleDataList"
      ></app-pi-schedule>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="currentComponent === 'TransactionFlow'">
  <div class="grid">
    <div class="sm:col-12 md:col-12 lg:col-12">
      <app-transaction-flow
        [paymentColumnDefs]="loanPaymentColumnDefs"
        [paymentDataList]="loanPaymentDataList"
        [transactionDataList]="transactionDataList"
        [transactionsColumnDef]="transactionsColumnDef"
        [facilityType]="facilityType"
        [paymentNotYetAllocated]="paymentNotYetAllocated"
        [overDue]="overDue"
      ></app-transaction-flow>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="currentComponent === 'AssociatedAssets'">
  <div class="grid">
    <div class="sm:col-12 md:col-12 lg:col-12">
      <app-facility-assets
        [columnsFacilityAsset]="associatedAsetscolumnDefs"
        [facilityType]="facilityType"
        [facilityAsssetsDatalist]="associatedAssetsDataList"
      ></app-facility-assets>
    </div>
  </div>
</ng-container>

<ng-container *ngIf="currentComponent === 'Documents'">
  <div class="grid">
    <div class="sm:col-12 md:col-12 lg:col-12">
      <app-documents
        [documentsColumnDefs]="documentsColumnDefs"
        [documentsDataList]="documentsDataList"
        [facilityType]="facilityType"
        (documentEmitter)="onDocumentClick($event)"
        (docUploadEmitter)="onDocUploadClick($event)"
      ></app-documents>
    </div>
  </div>
</ng-container>
